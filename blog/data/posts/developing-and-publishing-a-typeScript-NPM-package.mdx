---
title: Developing and Publishing a TypeScript NPM Package
subtitle: "We'll also cover unit testing, test coverage and code analysis"
date: '2021-01-19'
lastmod: '2021-01-19'
tags:
  - NPM
  - TypeScript
  - Technology
  - Nodejs
  - JavaScript
readingList:
  - NPM Library
draft: false
images:
  - /static/posts/makenpm.png
---

<InlineImage
  src="/static/posts/makenpm.png"
  alt="A picture of a dog sitting in front of boxes looking at the camera."
  caption={
    <>
      Image source: <a href="https://unsplash.com/photos/pDsmoI5j3B8">Unsplash</a>
    </>
  }
/>

### Introduction

Ever wondered how to publish your very own npm package to the npmjs.com registry? In this article, I'll take you through the step-by-step process. We'll start by developing a very simple npm package using TypeScript. Next, we'll add unit tests to confirm the accuracy of the functionality we're developing and while we're at it, we'll also produce a test coverage report. After that, we'll use static code analyzers to help us improve our code quality. Finally, we'll make use of some command-line magic to publish this package to npmjs.com. Doesn't that sound exciting? Let's begin.

> **Note:** The steps below are mentioned in a linear fashion for brevity. In reality, you might find yourself doing things iteratively — and that's okay.

<hr />

### Step 1: Develop

#### Initialize files and folders

In your project folder type in the command `npm init -y`. This will create an empty npm project with a sample `package.json` file. Let's not worry about that for now — we'll update it later.

You would also want to create a `README.md` file to write up an overview of your npm package, a `LICENSE` file which will contain the appropriate license text, and a `.gitignore` file which will tell Git what files and folders should not be source-controlled. We'll also create a `src` folder which will contain all of our source code.

![Image of source code directory.](/static/posts/1_glIaPPkmBzmXlKWHs8AM1g.png)

#### Adding some code

Let's populate the `src` folder with some actual code. We'll be using TypeScript for this demo which will then get compiled to JavaScript.

Create a file called `add-demo-npm.ts` in the `src` folder — this file will be the entry point for our package. You can name this file whatever you like, I just like naming it the same name as my npm package name. Write the following piece of code to include a simple add method.

```ts
export function add(a: number, b: number): number {
  return a + b
}
```

#### Compiling code

Now, we want our TypeScript code to compile to JavaScript. To do so, let's install the TypeScript module using the command `npm i typescript -D`. In your `package.json` file, replace `“main”: “index.js”,` with `“main”: “./dist/add-demo-npm.js”,` keeping the rest of the contents the same.

Next, let's create a `tsconfig.json` file with the following contents. This tells the TypeScript compiler how to compile, where to place the output files and what folders to exclude from the compilation.

```json
{
  "compilerOptions": {
    "target": "es6",
    "module": "commonjs",
    "strict": true,
    "declaration": true,
    "outDir": "./dist"
  },
  "exclude": ["tests", "dist", "node_modules"]
}
```

Now, update the scripts section of the `package.json` file to add a build script like the snippet below.

```json
"scripts": {
  "build": "tsc",
  "test": "echo \"Error: no test specified\" && exit 1"
},
```

> **Tip:** Where possible, I try to use a config file to supply the command-line tool additional options thereby keeping the actual command to a bare minimum. It looks a lot cleaner and is very readable.

To compile, execute the command `npm run build`. You should see a folder named dist being created with the compiled JavaScript file and a corresponding TypeScript definition file.

![Image of the dist folder with compiled files in it.](/static/posts/1_P9sHtBNJvkfKk7gKlO8gQA.png)

<hr />

### Step 2: Adding some tests

We want to ensure that the code we're writing works well in all scenarios. The easiest way to do so is to write tests that cover different scenarios.

<CustomAd isRandom={false} adKey="GLIDE" />

We'll be using [Mocha](https://mochajs.org/) as the JavaScript testing framework and [Chai](https://www.chaijs.com/) as the assertion library. Since we're testing source code written in TypeScript, we'll be using [ts-mocha](https://www.npmjs.com/package/ts-mocha) which is a thin TypeScript wrapper to use Mocha.

Let's install the npm packages `ts-mocha`, `mocha`, `chai` and their type definitions `@types/mocha` and `@types/chai`.

> **Tip:** You can install multiple npm packages with a single command using the format `npm i -D package1 package2 packageN`.

Next, create a folder in your root directory called `tests` and create a file called `add-demo-npm.test.ts`. I like to name the test file the same as the file we'll be unit testing. Copy the code snippet below into your file and feel free to add more tests if you like.

```ts
import { add } from '../src/add-demo-npm'
import { expect } from 'chai'

describe('add-demo-npm unit tests', (): void => {
  it('adding two positive numbers', (): void => {
    const actual: number = add(1, 2)
    expect(actual).is.equal(3)
  })
  it('adding two negative numbers', (): void => {
    const actual: number = add(-5, -2)
    expect(actual).is.equal(-7)
  })
  it('adding one positive and one negative number', (): void => {
    const actual: number = add(7, -2)
    expect(actual).is.equal(5)
  })
})
```

Then update the test script in the scripts section of the `package.json` file to execute the tests as shown below.

```json
"scripts": {
    "build": "tsc",
    "test": "ts-mocha tests/**/*.test.ts"
},
```

Run `npm test` to execute these tests and confirm all unit tests are passing.

![Image of all unit tests passing.](/static/posts/1_3TuIbTnJsFF716Il2HhCLw.png)

#### Test coverage

We'll be using [nyc](https://github.com/istanbuljs/nyc) to add test coverage on top of our Mocha tests. Let's run `npm i nyc -D` to install this npm package.

Next, let's add a config file named `.nycrc.json` with the contents from the code snippet below. The config file tells nyc how to execute, what file types to include, what reporters (a.k.a. output formats) to use, and what is the benchmark (which can be updated to any number you like) to compare the results with. A full list of reporters can be found [here](https://istanbul.js.org/docs/advanced/alternative-reporters/).

```json
{
  "cache": false,
  "check-coverage": true,
  "extension": [".ts"],
  "include": ["**/src/*.ts"],
  "reporter": ["cobertura", "text-summary"],
  "statements": 90,
  "branches": 90,
  "functions": 90,
  "lines": 90
}
```

Update the scripts section in the `package.json` file with the command to execute nyc as shown below.

```json
"scripts": {
    "build": "tsc",
    "test": "ts-mocha tests/**/*.test.ts",
    "coverage": "nyc npm test"
},
```

Finally, we'll run the command `npm run coverage` to see this in action.

![Image of test coverage summary report.](/static/posts/1_5oirZp9M6kxHb85XNwh60g.png)

<hr />

### Step 3: Code analysis

#### Linting using ESLint

[ESLint](https://eslint.org/) analyzes code to find and report problems and enforces [rules](https://eslint.org/docs/rules/) so you have a consistent style of coding.

To install, run the command `npm i eslint -D`. Next, add a config file named `.eslintrc.json` and paste the contents from the code snippet below into this config file. Since ESLint is completely configurable, you can customize this file as required. The official guide to configuring ESLint can be found [here](https://eslint.org/docs/2.0.0/user-guide/configuring).

```json
{
  "root": true,
  "parser": "@typescript-eslint/parser",
  "plugins": ["@typescript-eslint"],
  "env": {
    "es6": true,
    "node": true,
    "mocha": true
  },
  "extends": [
    "eslint:recommended",
    "plugin:@typescript-eslint/eslint-recommended",
    "plugin:@typescript-eslint/recommended"
  ],
  "parserOptions": {
    "ecmaVersion": 2018,
    "sourceType": "module"
  },
  "rules": {
    "no-console": "off",
    "linebreak-style": "off",
    "quotes": ["error", "double", { "allowTemplateLiterals": true }],
    "keyword-spacing": ["error", { "before": true }],
    "space-before-blocks": ["error"]
  }
}
```

Since we're using the `@typescript-eslint/parser` parser and `@typescript-eslint/eslint-plugin` plugin, we'll need to install these npm packages as a dev dependency as well.

Add the required commands to lint the TypeScript files in the scripts section of the `package.json` file as shown in the code snippet below.

```json
"scripts": {
  "build": "tsc",
  "test": "ts-mocha tests/**/*.test.ts",
  "coverage": "nyc npm test",
  "lint": "eslint \"**\\*.ts\""
},
```

Execute `npm run lint` to perform the lint operation. To test, remove the whitespace between numbers and brackets and execute the command again — you should get an error.

![Image of a function highlighting the whitespace to remove so ESLint can be tested.](/static/posts/1_FCba-GGzGlthx3S0TUPE0w.png)

You can add or remove rules as you see fit for your project. Full list of rules can be found [here](https://eslint.org/docs/rules/).

#### Code quality using SonarCloud

SonarCloud is a static code analyzer that scans your source code and assesses metrics like maintainability, reliability, duplication, and also identifies security issues. It's more in-depth than just using ESLint.

I have my source code in GitHub, so I'll quickly walk you through how you might connect SonarCloud with your GitHub repository.

Head over to [sonarcloud.io](https://sonarcloud.io/) and click on **GitHub** to hook your repository.

![Screenshot of SonarCloud's home page.](/static/posts/1_RaHozMw9-nlB0qbY4KRWdg.png)

You may be asked to log in and authorize SonarCloud app in GitHub — grant the required permissions when asked. Once you head over to your SonarCloud projects dashboard page, click on the ‘**+**' icon and then from the dropdown, select **”analyze new project”**.

![Screenshot of SonarCloud projects home page and arrows pointing the buttons to click.](/static/posts/1_Z8p_nSdIRhWi64BQcn6_Yw.png)

Search for your repository, check the box beside it, and then click on the **Set Up**.

![Image showing the steps to add a GitHub repository to SonarCloud.](/static/posts/1_PuKpNRcfqW5RP-AvsYgVHw.png)

SonarCloud will start analyzing your project and show you the first analysis report.

![Screenshot of SonarCloud analyzing the source code for the first time.](/static/posts/1_6wNMM2eCYpPnDxsCcM5M3w.png)

Before wrapping things up with SonarCloud, there's one additional thing you'd require to do before you can get a quality gate from SonarCloud. Click on **Administration** and from the dropdown, select **New Code**. Then, select the **Previous version** from the list of options. This means that the quality gate will be computed every time new code is checked in and all the metrics will focus on what has just changed.

![Image showing the steps to set new code definition in SonarCloud.](/static/posts/1_BZjOwI4RtXBGy2wzYN4mrg.png)

What's awesome about SonarCloud is that it triggers an analysis on every new pull request and adds a comment on your GitHub pull request with a summary about the analysis.

![Screenshot of a SonarCloud quality gate comment in a GitHub pull request.](/static/posts/1_yJqWMM25PzycSqv0_KxjOg.png)

If you head over to the **Overview** tab in SonarCloud, you can see various metrics, and should one of those tiles need your attention, you can click on it to find out more and make the required code changes.

![Screenshot of SonarCloud's overview tab.](/static/posts/1_6dBuZKsb0a4F7yLAg6nB-g.png)

<hr />

### Step 4: Housekeeping

#### Updating the package.json file

Before we go ahead and publish the npm package, we'll need to update the `package.json` file. See [this commit diff](https://github.com/ClydeDz/add-demo-npm/commit/8aeadfd1e2622b35a203dfbe7e85c303aeeca400?branch=8aeadfd1e2622b35a203dfbe7e85c303aeeca400&diff=split) to see what has been updated and the code snippet below to see what the final version of the `package.json` file looks like.

```json
{
  "name": "add-demo-npm",
  "version": "0.1.0",
  "description": "A demo npm package to compliment a Medium how-to article.",
  "main": "./dist/add-demo-npm.js",
  "scripts": {
    "build": "tsc",
    "test": "ts-mocha tests/**/*.test.ts",
    "coverage": "nyc npm test",
    "lint": "eslint \"**\\*.ts\""
  },
  "files": ["dist", "LICENSE", "README.md"],
  "repository": {
    "type": "git",
    "url": "git+https://github.com/ClydeDz/add-demo-npm.git"
  },
  "keywords": ["demo npm", "add", "calculate"],
  "author": "Clyde D'Souza",
  "license": "MIT",
  "bugs": {
    "url": "https://github.com/ClydeDz/add-demo-npm/issues"
  },
  "homepage": "https://github.com/ClydeDz/add-demo-npm#readme",
  "devDependencies": {
    "@types/chai": "^4.2.14",
    "@types/mocha": "^8.2.0",
    "@typescript-eslint/eslint-plugin": "^4.13.0",
    "@typescript-eslint/parser": "^4.13.0",
    "chai": "^4.2.0",
    "eslint": "^7.17.0",
    "mocha": "^8.2.1",
    "nyc": "^15.1.0",
    "ts-mocha": "^8.0.0",
    "typescript": "^4.1.3"
  }
}
```

A full explanation on each item of the package.json file can be found [here](https://docs.npmjs.com/cli/v6/configuring-npm/package-json). However, here are a couple of special mentions:

- The name of the npm package is the most important item in the package.json file as that value uniquely identifies your package. Apart from the rules outlined [here](https://docs.npmjs.com/cli/v6/configuring-npm/package-json#name), I would recommend researching an apt name for your npm package and then not changing this value ever.
- The value entered in the description doesn't actually show up on the npm package page but shows up in the search results when you search for one.
- The version number has to be of a [valid semver format](https://semver.org/).
- The license identifier should be one from the [SPDX license list](https://spdx.org/licenses/) and ideally should also be [OSI approved](https://opensource.org/licenses/alphabetical).
- Only add npm packages to the dependencies section if your npm package requires them once installed on users' machines. All the other npm packages that you require during development goes into the devDependencies section.
- You can add any number of custom scripts into the scripts section. Think of this like adding aliases to running your actual command instead of actually typing it out.

#### Readme file

Update the contents of the readme file to be as detailed as possible, thereby, making it very clear for other developers to consume your npm package easily. This file is written in Markdown format and the npm package page converts Markdown contents to HTML.

<hr />

<GoogleAds adLayout="Responsive" />

### Step 5: Publish

#### Publishing via the command-line interface (CLI)

We'll be publishing our npm package to [npmjs.com](https://www.npmjs.com/signup) using a command-line interface (CLI). A full list of available commands can be found [here](https://docs.npmjs.com/cli/commands/).

#### Login

Head over to [npmjs.com](https://www.npmjs.com/signup) and sign up for a new account if you don't have one already. Next, open up a terminal in Visual Studio Code, and type in the command `npm adduser`. Then, enter the username, password, and email address associated with your account.

![Screenshot showing npm adduser command in action.](/static/posts/1_OLbRAq7afwNuPwB-C7u0ww.png)

#### Getting help

At any given time, should you require help with any of the commands, just type the command followed by `-help`.

![Screenshot showing how to get help for a command in npm.](/static/posts/1_WzlVuSE84a7k_We_c9gJhA.png)

#### Confirm log in

To confirm that you are logged in to npm using CLI, type in the command `npm whoami` which should return the logged-in username.

#### What am I distributing?

To check what files will be packaged into your npm package, we can use the command `npm publish --dry-run`. Running this **_will not_** publish your npm package.

![Screenshot showing npm dry-run command in action.](/static/posts/1_Ctcy9EteMNQbJIkjhctTVw.png)

#### Publish!

Finally, when you're ready to publish your npm package, type in the command `npm publish`. This will publish your npm package and within minutes, you should also get a confirmation email.

![Screenshot showing npm publish command in action.](/static/posts/1_bQB1HxaE0XmyBOgY8cQY7g.png)

#### Package page on npmjs.com

Once published, you should be able to view your npm package page. Here are a couple of points highlighted.

![Screenshot of the demo npm package's public page.](/static/posts/1_Jih4daKTE6z2iTHd1OLVpA.png)

1. **Readme:** The contents of the readme file will appear on your npm package page. Markdown is supported, so get creative!
2. **Keywords:** The keywords/tags you enter in your package.json file will also appear on your npm package page.
3. **Version, license, homepage, and repository:** These will be picked up from your package.json file.
4. **Dependencies:** This tab will show you what your npm package is dependent upon. Dev dependencies don't add up to the count.
5. **TypeScript logo:** Hovering your mouse over this icon gives you the following message: “This package contains built-in TypeScript declarations.” This is referring to the type definition file `add-demo-npm.d.ts` created in the dist folder.
6. **Collaborators:** By default, this would be your username. If you'd like to add more owners/contributors to this list, check out the [npm-owner](https://docs.npmjs.com/cli/v6/commands/npm-owner) CLI command.

#### Logout

After everything's done, use the command `npm logout` to logout from the CLI.

<hr />

### Demo material

If you'd like to check out this demo in action, you can download the npm package from [here](https://www.npmjs.com/package/add-demo-npm) and have a look at the source code on [GitHub](https://github.com/ClydeDz/add-demo-npm).

### Summary

Alright, time for a quick recap —

- We developed the package using TypeScript and used `tsc` to compile TypeScript files to JavaScript.
- We used ts-mocha to unit test our TypeScript code with Mocha as the testing framework and Chai as the assertion library. We followed that up with nyc to add a test coverage report.
- Next, we installed ESLint to ensure that we're writing code in a consistent. We complemented that with SonarCloud which analyzes the source code for various metrics like maintainability, reliability duplication and also identifies security issues.
- Before publishing, we did some housekeeping where we updated the `package.json` and `README.md` files.
- Finally, we used npm's command-line interface to log in to npmjs.com and publish the npm package.

See, it wasn't that daunting, was it? Give it a try and let me know in the comments how did you find this, okay?

That's it. Thanks for reading!
